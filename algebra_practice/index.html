<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Algebra Practice â€“ Solve for x</title>
  <style>
    * { box-sizing: border-box; }
    :root { color-scheme: light; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: transparent;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 12px;
      padding-top: calc(12px + env(safe-area-inset-top));
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
      padding-left: calc(12px + env(safe-area-inset-left));
      padding-right: calc(12px + env(safe-area-inset-right));
      overflow: hidden;
      touch-action: none;
      user-select: none;
    }
    .app {
      width: min(520px, 100%);
      background: rgba(255, 255, 255, 0.88);
      border: 1px solid #e5e5e5;
      border-radius: 16px;
      padding: clamp(16px, 4vw, 24px);
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
      display: flex;
      flex-direction: column;
      gap: clamp(12px, 3vw, 18px);
      position: relative;
      z-index: 1;
      user-select: none;
    }
    .topBar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    h1 {
      margin: 0;
      font-size: clamp(18px, 4.5vw, 24px);
      font-weight: 600;
      pointer-events: none;
    }
    .pill {
      display: inline-block;
      font-size: 12px;
      padding: 2px 8px;
      border: 1px solid #ddd;
      border-radius: 999px;
      background: #fcfcfc;
      margin-left: 6px;
      pointer-events: none;
    }
    .equation {
      font-size: clamp(26px, 7vw, 38px);
      text-align: center;
      font-weight: 600;
      padding: clamp(12px, 3vw, 18px);
      border-radius: 14px;
      background: rgba(232, 241, 255, 0.7);
      color: #0d47a1;
      box-shadow: inset 0 0 0 1px rgba(21, 101, 192, 0.2);
      min-height: clamp(68px, 18vw, 88px);
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(2px);
      pointer-events: none;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .answerRow {
      justify-content: center;
      gap: 8px;
    }
    .answerRow label {
      pointer-events: none;
      font-size: clamp(16px, 4vw, 18px);
    }
    .answerRow input[type="text"] {
      font-size: clamp(17px, 4.5vw, 20px);
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #c8d6f4;
      text-align: center;
      flex: 1 1 auto;
      min-width: 0;
      user-select: text;
    }
    .secondaryRow {
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      font-size: 16px;
      padding: 10px 14px;
      border-radius: 12px;
      border: 2px solid transparent;
      cursor: pointer;
      color: #fff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      touch-action: manipulation;
    }
    .btn:focus {
      outline: 3px solid #222;
      outline-offset: 2px;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }
    .btn-primary { background: #1565c0; }
    .btn-primary:hover { background: #0d47a1; }
    .btn-accent  { background: #2e7d32; }
    .btn-accent:hover  { background: #1b5e20; }
    .btn-warn    { background: #ef6c00; }
    .btn-warn:hover    { background: #e65100; }
    .btn-ghost   { background: #3d5a80; }
    .btn-ghost:hover   { background: #2b3e5c; }
    .btn-small {
      font-size: 14px;
      padding: 8px 12px;
    }

    .feedback {
      font-size: 16px;
      min-height: 24px;
      text-align: center;
      pointer-events: none;
    }
    .ok { color: #0a7a0a; font-weight: bold; }
    .bad { color: #b00020; font-weight: bold; }

    .optionsWrap {
      position: relative;
      flex-shrink: 0;
    }
    .configPanel {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid #d5dcf5;
      background: rgba(249, 250, 255, 0.98);
      box-shadow: 0 12px 28px rgba(13, 71, 161, 0.18);
      min-width: 210px;
      opacity: 0;
      pointer-events: none;
      transform: translateY(-6px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 2;
    }
    .configPanel label {
      font-size: 14px;
      display: flex;
      gap: 8px;
      align-items: center;
      line-height: 1.3;
    }
    .optionsWrap.open .configPanel {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .padBox { margin-top: 4px; position: relative; }
    .padHeader {
      font-size: 15px;
      font-weight: 600;
      color: #333;
      margin-bottom: 6px;
      pointer-events: none;
    }
    #pad {
      position: fixed;
      inset: 0;
      border: none;
      background: #f7f7f7;
      touch-action: none;
      cursor: crosshair;
      z-index: -1;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
    }

    @media (max-width: 520px) {
      .app {
        border-radius: 14px;
      }
      .btn {
        font-size: 15px;
      }
    }
  </style>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      messageStyle: 'none',
      showProcessingMessages: false,
      tex2jax: { preview: 'none', inlineMath: [['$$','$$'], ['\\(','\\)']] }
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js?config=TeX-AMS_HTML" type="text/javascript" async></script>
</head>
<body>
  <div class="app">
    <div class="topBar">
      <h1>Solve for <b>x</b> <span class="pill">Integers + simple fractions</span></h1>
      <div class="optionsWrap" id="optionsWrap" data-pad-ignore>
        <button class="btn btn-ghost btn-small" id="optionsBtn" aria-haspopup="true" aria-expanded="false" aria-controls="configPanel" data-pad-ignore>Options</button>
        <div class="configPanel" id="configPanel" role="group" aria-label="Complexity settings" data-pad-ignore tabindex="-1">
          <label><input type="checkbox" id="cfgFracCoeff" checked> Fraction coefficients/constants</label>
          <label><input type="checkbox" id="cfgFracSol" checked> Fraction solution</label>
          <label><input type="checkbox" id="cfgNeg" checked> Allow negatives</label>
        </div>
      </div>
    </div>

    <div id="equation" class="equation">&nbsp;</div>

    <div class="row answerRow">
      <label for="answer"><b>x</b> =</label>
      <input id="answer" type="text" inputmode="decimal" placeholder="e.g. 3, 1/2, -2.5" />
      <button class="btn btn-primary" id="checkBtn" title="Check your answer">Check</button>
    </div>

    <div class="row secondaryRow">
      <button class="btn btn-accent" id="newBtn" title="Generate a new question">New Question</button>
      <button class="btn btn-warn" id="showBtn" title="Reveal the answer">Show Answer</button>
      <button class="btn btn-ghost" id="clearPadBtn" title="Clear the scratch pad" data-pad-ignore>Clear Pad</button>
    </div>

    <div id="feedback" class="feedback"></div>

    <div class="padBox">
      <div class="padHeader">Scratch pad</div>
      <canvas id="pad"></canvas>
    </div>
  </div>

  <script>
    // --- Fractions (pre-ES6) ---
    function _gcd(a,b){a=Math.abs(a);b=Math.abs(b);while(b){var t=a%b;a=b;b=t;}return a||1;}
    function makeFrac(n,d){if(d===0){throw new Error('Zero denominator');}if(d<0){n=-n;d=-d;}if(n===0){return{n:0,d:1};}var g=_gcd(n,d);return{n:n/g,d:d/g};}
    function addFrac(a,b){return makeFrac(a.n*b.d+b.n*a.d,a.d*b.d);}
    function mulFrac(a,b){return makeFrac(a.n*b.n,a.d*b.d);}
    function intFrac(k){return{n:k,d:1};}
    function parseToFrac(s){
      if(!s){return null;} s=s.replace(/\s+/g,''); if(!s){return null;}
      var sign=1; if(s.charAt(0)==='+'){s=s.slice(1);} else if(s.charAt(0)==='-'){sign=-1; s=s.slice(1);}
      if(s.indexOf('/')!==-1){var p=s.split('/'); if(p.length!==2){return null;}
        var a=parseInt(p[0],10), b=parseInt(p[1],10); if(isNaN(a)||isNaN(b)){return null;} return makeFrac(sign*a,b);}
      if(s.indexOf('.')!==-1){var bits=s.split('.'); if(bits.length!==2){return null;}
        var whole=bits[0]?parseInt(bits[0],10):0; var fracStr=bits[1]; if(isNaN(whole)||!/^[0-9]+$/.test(fracStr)){return null;}
        var scale=1; for(var i=0;i<fracStr.length;i++){scale*=10;} var num=Math.abs(whole)*scale+parseInt(fracStr,10); if(whole<0){num=-num;}
        var f=makeFrac(num,scale); f.n*=sign; return f;}
      var k=parseInt(s,10); if(isNaN(k)){return null;} return makeFrac(sign*k,1);
    }
    function sameFrac(a,b){return a.n===b.n&&a.d===b.d;}
    function fracToString(f){return f.d===1?String(f.n):f.n+'/'+f.d;}
    function fracToTex(f){if(f.n===0){return'0';}if(f.d===1){return String(f.n);}var sign=f.n<0?'-':'';var abs=makeFrac(Math.abs(f.n),f.d);return sign+'\\frac{'+abs.n+'}{'+abs.d+'}';}
    function coeffTimesXToTex(a){if(a.n===0){return'0';}if(a.d===1){if(a.n===1){return'x';}if(a.n===-1){return'-x';}return fracToTex(a)+'x';}var abs=makeFrac(Math.abs(a.n),a.d);var sign=a.n<0?'-':'';return sign+'\\frac{'+abs.n+'}{'+abs.d+'}x';}
    function signJoinTex(v){if(v.n===0){return'';}var abs=makeFrac(Math.abs(v.n),v.d);return(v.n>0?' + ':' - ')+fracToTex(abs);}

    function typesetElement(el){if(window.MathJax&&MathJax.Hub&&el){MathJax.Hub.Queue(['Typeset',MathJax.Hub,el]);}}

    // --- Random helpers ---
    function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
    function randChoice(a){return a[randInt(0,a.length-1)];}
    var DEN_SET=[1,2,3,4,5,6,8,10];

    function randomNiceFracNonNeg(allowOne){var d=randChoice(DEN_SET);var nMax=d*4;var n=randInt(1,nMax);var f=makeFrac(n,d);if(!allowOne&&Math.abs(f.n)===f.d){f=makeFrac(f.n+1,f.d);}return f;}
    function randomNiceFracSigned(allowOne){var d=randChoice(DEN_SET);var nMax=d*4;var n=randInt(-nMax,nMax);if(n===0){n=1;}var f=makeFrac(n,d);if(!allowOne&&Math.abs(f.n)===f.d){f=makeFrac(f.n+(f.n>0?1:-1),f.d);}return f;}

    // Settings
    var SETTINGS={allowFractionCoeffs:true,allowFractionSolution:true,allowNegatives:true};

    function randomCoeffA(st){var allowFrac=st.allowFractionCoeffs, allowNeg=st.allowNegatives;
      if(!allowFrac){var k=allowNeg?randInt(-12,12):randInt(1,12); if(k===0){k=2;} if(!allowNeg&&k<0){k=-k;} return makeFrac(k,1);}
      return allowNeg?randomNiceFracSigned(false):randomNiceFracNonNeg(false);
    }
    function randomConst(st){var allowFrac=st.allowFractionCoeffs, allowNeg=st.allowNegatives;
      if(!allowFrac){var lo=allowNeg?-20:0; return makeFrac(randInt(lo,20),1);}
      return allowNeg?randomNiceFracSigned(true):randomNiceFracNonNeg(true);
    }
    function chooseSolution(st){var allowFracSol=st.allowFractionSolution, allowNeg=st.allowNegatives;
      if(!allowFracSol){var lo=allowNeg?-10:0; var xk=randInt(lo,10); if(xk===0){xk=3;} return makeFrac(xk,1);}
      return allowNeg?randomNiceFracSigned(true):randomNiceFracNonNeg(true);
    }

    var CURRENT=null;

    function generateProblem(){
      var x=chooseSolution(SETTINGS);
      var a=randomCoeffA(SETTINGS); if(a.n===0){a=makeFrac(2,1);}
      var b=randomConst(SETTINGS);
      var c=addFrac(mulFrac(a,x),b);
      CURRENT={a:a,b:b,c:c,x:x};
    }
    function renderProblem(){
      var a=CURRENT.a,b=CURRENT.b,c=CURRENT.c;
      var left=coeffTimesXToTex(a);
      if(b.n!==0){left+=signJoinTex(b);}
      var eqTex=left+' = '+fracToTex(c);
      var eqEl=document.getElementById('equation');
      eqEl.innerHTML='$$'+eqTex+'$$';
      document.getElementById('feedback').textContent='';
      document.getElementById('answer').value='';
      sizePad({preserve:false});
      typesetElement(eqEl);
    }
    function checkAnswer(){
      var s=document.getElementById('answer').value;
      var f=parseToFrac(s); var fb=document.getElementById('feedback');
      if(!f){fb.innerHTML='<span class="bad">Invalid input.</span> Examples: <code>3</code>, <code>-2</code>, <code>1/2</code>, <code>-2.5</code>'; return;}
      var correct=CURRENT.x;
      if(sameFrac(f,correct)){fb.innerHTML='<span class="ok">Correct.</span>';}
      else {var v1=f.n/f.d, v2=correct.n/correct.d; fb.innerHTML=(Math.abs(v1-v2)<1e-9)?'<span class="ok">Correct.</span>':'<span class="bad">Not correct.</span> Try again.';}
    }
    function showAnswer(){var fb=document.getElementById('feedback'); fb.innerHTML='Answer:&nbsp;$$x = '+fracToTex(CURRENT.x)+'$$'; typesetElement(fb); }

    // Scratch pad
    var pad=document.getElementById('pad'), ctx=pad.getContext('2d');
    var drawing=false, lastX=0, lastY=0, dpr=window.devicePixelRatio||1;
    function clearPad(){
      ctx.save();
      ctx.setTransform(1,0,0,1,0,0);
      ctx.clearRect(0,0,pad.width,pad.height);
      ctx.restore();
    }
    function sizePad(options){
      options=options||{};
      dpr=window.devicePixelRatio||1;
      var width=window.innerWidth||document.documentElement.clientWidth||pad.clientWidth||0;
      var height=window.innerHeight||document.documentElement.clientHeight||pad.clientHeight||0;
      var preserve=!!options.preserve;
      var snapshot=null;
      if(preserve&&pad.width&&pad.height){
        snapshot=document.createElement('canvas');
        snapshot.width=pad.width;
        snapshot.height=pad.height;
        snapshot.getContext('2d').drawImage(pad,0,0);
      }
      pad.width=Math.max(1,Math.floor(width*dpr));
      pad.height=Math.max(1,Math.floor(height*dpr));
      pad.style.width=width+'px';
      pad.style.height=height+'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
      if(snapshot){
        ctx.drawImage(snapshot,0,0,snapshot.width,snapshot.height,0,0,width,height);
      } else {
        clearPad();
      }
    }
    function toCanvasCoords(ev){
      return {x:ev.clientX,y:ev.clientY};
    }
    function isInteractiveTarget(el){
      return !!(el&&el.closest('button, input, select, textarea, a, [data-pad-ignore]'));
    }
    function startDraw(ev){
      drawing=true;
      var p=toCanvasCoords(ev);
      lastX=p.x;
      lastY=p.y;
    }
    function drawTo(ev){
      if(!drawing){return;}
      var p=toCanvasCoords(ev);
      ctx.lineWidth=2;
      ctx.lineCap='round';
      ctx.strokeStyle='#000';
      ctx.beginPath();
      ctx.moveTo(lastX,lastY);
      ctx.lineTo(p.x,p.y);
      ctx.stroke();
      lastX=p.x;
      lastY=p.y;
    }
    function endDraw(){drawing=false;}
    window.addEventListener('pointerdown',function(ev){
      if(ev.pointerType==='mouse'&&ev.button!==0){return;}
      if(isInteractiveTarget(ev.target)){drawing=false;return;}
      ev.preventDefault();
      startDraw(ev);
    },{passive:false,capture:true});
    window.addEventListener('pointermove',function(ev){
      if(!drawing){return;}
      if(ev.pointerType==='mouse'&&ev.buttons===0){endDraw();return;}
      ev.preventDefault();
      drawTo(ev);
    },{passive:false,capture:true});
    window.addEventListener('pointerup',endDraw);
    window.addEventListener('pointercancel',endDraw);
    window.addEventListener('pointerleave',function(){endDraw();});
    document.getElementById('clearPadBtn').addEventListener('click',function(){clearPad();});

    // Wire up
    document.getElementById('checkBtn').addEventListener('click',function(){checkAnswer();});
    document.getElementById('newBtn').addEventListener('click',function(){generateProblem(); renderProblem();});
    document.getElementById('showBtn').addEventListener('click',function(){showAnswer();});
    document.getElementById('answer').addEventListener('keydown',function(e){e=e||window.event; if(e.key==='Enter'||e.keyCode===13){checkAnswer();}});

    // Config hooks
    document.getElementById('cfgFracCoeff').addEventListener('change',function(){SETTINGS.allowFractionCoeffs=!!this.checked; generateProblem(); renderProblem();});
    document.getElementById('cfgFracSol').addEventListener('change',function(){SETTINGS.allowFractionSolution=!!this.checked; generateProblem(); renderProblem();});
    document.getElementById('cfgNeg').addEventListener('change',function(){SETTINGS.allowNegatives=!!this.checked; generateProblem(); renderProblem();});

    var optionsWrap=document.getElementById('optionsWrap');
    var optionsBtn=document.getElementById('optionsBtn');
    var configPanel=document.getElementById('configPanel');
    function closeOptions(){optionsWrap.classList.remove('open'); optionsBtn.setAttribute('aria-expanded','false');}
    function toggleOptions(){var isOpen=optionsWrap.classList.toggle('open'); optionsBtn.setAttribute('aria-expanded',isOpen?'true':'false'); if(isOpen&&configPanel&&configPanel.focus){configPanel.focus({preventScroll:true});}}
    optionsBtn.addEventListener('click',function(ev){ev.stopPropagation(); toggleOptions();});
    document.addEventListener('click',function(ev){if(!optionsWrap.contains(ev.target)){closeOptions();}});
    document.addEventListener('keydown',function(ev){if(ev.key==='Escape'){closeOptions();}});

    // Init
    generateProblem();
    renderProblem();
    window.addEventListener('resize',function(){sizePad({preserve:true});});
  </script>
</body>
</html>
